import{a as ke,b as Te,d as Ne,e as De,f as ae,g as Me,h as re,j as Ae,k as Ie,l as Ve}from"./chunk-PK4J3UXM.js";import{a as xe,b as oe,c as he,d as Ce,e as Fe,f as Se,g as Ee,h as Pe,i as ye}from"./chunk-IBUA52PN.js";import{G as W}from"./chunk-S32ZPM5K.js";import{a as we}from"./chunk-AXDP3B2M.js";import{e as K,i as Q,k as ve,l as _e,o as fe,p as be,r as B}from"./chunk-Q4CSJZBT.js";import{$ as u,Ca as G,E as $,Eb as U,Fa as a,Fb as de,Gb as o,Hb as y,Ib as S,Jb as ce,Lb as V,Mb as pe,Nb as ue,O as le,Q as H,Sb as J,Tb as ge,Ub as j,Va as E,W as q,Yb as w,a as te,b as ie,ea as h,fa as C,fb as v,ga as N,gb as _,ha as D,hb as me,ib as k,jb as T,kb as F,lb as r,mb as s,na as g,nb as f,ob as d,pb as c,qb as ne,r as R,s as x,tb as M,ub as I,vb as P,w as z,wb as O,xb as m}from"./chunk-B6KJMEWL.js";var A=class i{router=u(ve);route=u(Q);page=g(1);constructor(){this.route.queryParamMap.subscribe(t=>{let e=Number(t.get("page"))||1;this.page.set(e)})}currentPage=()=>this.page();setPage(t){this.router.navigate([],{relativeTo:this.route,queryParams:{page:t},queryParamsHandling:"merge"})}static \u0275fac=function(e){return new(e||i)};static \u0275prov=q({token:i,factory:i.\u0275fac,providedIn:"root"})};function Le(i,t){if(i&1){let e=M();d(0,"button",3),O("click",function(){let l=h(e).$implicit,p=m();return C(p.goToPage(l))}),o(1),c()}if(i&2){let e=t.$implicit,n=m();U("btn-primary",e===n.activePage()),a(),S(" ",e," ")}}var X=class i{pages=w(0);currentPage=w(1);paginationService=u(A);activePage=g(1);constructor(){j(()=>{this.activePage.set(this.currentPage())})}getPagesList=ge(()=>{let t=this.pages(),e=this.activePage();if(t<=5)return Array.from({length:t},(p,b)=>b+1);let n=Math.max(1,e-2),l=Math.min(t,n+4);return Array.from({length:l-n+1},(p,b)=>n+b)});previousPage(){if(this.activePage()>1){let t=this.activePage()-1;this.activePage.set(t),this.paginationService.setPage(t)}}nextPage(){if(this.activePage()<this.pages()){let t=this.activePage()+1;this.activePage.set(t),this.paginationService.setPage(t)}}goToPage(t){this.activePage.set(t),this.paginationService.setPage(t)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=E({type:i,selectors:[["app-pagination-component"]],inputs:{pages:[1,"pages"],currentPage:[1,"currentPage"]},decls:7,vars:2,consts:[[1,"join","flex","justify-center","items-center","gap-2"],[1,"join-item","btn",3,"click","disabled"],[1,"join-item","btn",3,"btn-primary"],[1,"join-item","btn",3,"click"]],template:function(e,n){e&1&&(d(0,"div",0)(1,"button",1),O("click",function(){return n.previousPage()}),o(2," \xAB "),c(),k(3,Le,2,3,"button",2,me),d(5,"button",1),O("click",function(){return n.nextPage()}),o(6," \xBB "),c()()),e&2&&(a(),I("disabled",n.activePage()===1),a(2),T(n.getPagesList()),a(2),I("disabled",n.activePage()===n.pages()))},encapsulation:2})};var Y=class i{simpsonsCount=w.required();totalPages=w.required();static \u0275fac=function(e){return new(e||i)};static \u0275cmp=E({type:i,selectors:[["app-hero-simpsons"]],inputs:{simpsonsCount:[1,"simpsonsCount"],totalPages:[1,"totalPages"]},decls:28,vars:2,consts:[["role","banner",1,"hero","bg-linear-to-r","from-yellow-400","via-yellow-500","to-orange-400","text-base-content"],[1,"hero-content","text-center","py-12"],[1,"max-w-md"],[1,"text-5xl","font-bold","text-black","drop-shadow-md"],[1,"py-6","text-lg","text-gray-800","font-medium"],[1,"stats","stats-horizontal","shadow-lg","bg-white/90"],[1,"stat"],[1,"stat-figure","text-primary"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"inline-block","w-8","h-8","stroke-current"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0zM7 10a2 2 0 11-4 0 2 2 0z"],[1,"stat-title","text-gray-700"],[1,"stat-value","text-primary"],[1,"stat-desc","text-gray-600"],[1,"stat-figure","text-secondary"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"],[1,"stat-value","text-secondary"]],template:function(e,n){e&1&&(d(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),o(4,"The Simpsons"),c(),d(5,"p",4),o(6," Explora el universo de la familia m\xE1s famosa de Springfield "),c(),d(7,"div",5)(8,"div",6)(9,"div",7),N(),d(10,"svg",8),ne(11,"path",9),c()(),D(),d(12,"div",10),o(13,"Personajes"),c(),d(14,"div",11),o(15),c(),d(16,"div",12),o(17,"Total de registros"),c()(),d(18,"div",6)(19,"div",13),N(),d(20,"svg",8),ne(21,"path",14),c()(),D(),d(22,"div",10),o(23,"P\xE1ginas"),c(),d(24,"div",15),o(25),c(),d(26,"div",12),o(27,"Total disponibles"),c()()()()()()),e&2&&(a(15),S(" ",n.simpsonsCount()," "),a(10),S(" ",n.totalPages()," "))},encapsulation:2})};var Re=(i,t)=>t.label;function ze(i,t){if(i&1&&(d(0,"a",1),o(1),c()),i&2){let e=m().$implicit;I("href",e.link,G),a(),S(" ",e.label," ")}}function $e(i,t){if(i&1&&(d(0,"span"),o(1),c()),i&2){let e=m().$implicit;a(),y(e.label)}}function He(i,t){if(i&1&&(d(0,"li"),v(1,ze,2,2,"a",1)(2,$e,2,1,"span"),c()),i&2){let e=t.$implicit;a(),_(e.link?1:2)}}var Z=class i{items=w([]);static \u0275fac=function(e){return new(e||i)};static \u0275cmp=E({type:i,selectors:[["app-breadcrumbs"]],inputs:{items:[1,"items"]},decls:4,vars:0,consts:[[1,"breadcrumbs","text-sm","px-6","py-3","bg-base-200"],[1,"link","link-hover",3,"href"]],template:function(e,n){e&1&&(d(0,"div",0)(1,"ul"),k(2,He,3,1,"li",null,Re),c()()),e&2&&(a(2),T(n.items()))},dependencies:[K],encapsulation:2})};var ee=class i{firestore=u(Te);authService=u(W);favorites=g([]);loading=g(!1);addFavorite(t,e,n){let l=this.authService.currentUser();if(!l)throw new Error("Usuario no autenticado");let p={nombre:t,customName:n||t,image:e,userId:l.uid,createdAt:new Date},b=ae(this.firestore,"favorites");return R(De(b,ie(te({},p),{createdAt:ke.fromDate(p.createdAt)})))}getFavorites(){let t=this.authService.currentUser();if(!t)return x([]);this.loading.set(!0);let e=ae(this.firestore,"favorites"),n=Ae(e,Ve("userId","==",t.uid));return Ne(n,{idField:"id"}).pipe(z(l=>{let p=l.map(b=>ie(te({},b),{createdAt:b.createdAt?.toDate?b.createdAt.toDate():b.createdAt}));return this.favorites.set(p),this.loading.set(!1),p}))}updateFavorite(t,e){let n=re(this.firestore,"favorites",t);return R(Ie(n,{customName:e}))}deleteFavorite(t){let e=re(this.firestore,"favorites",t);return R(Me(e))}isFavorite(t){return this.favorites().some(e=>e.nombre===t)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=q({token:i,factory:i.\u0275fac,providedIn:"root"})};var qe=()=>({label:"Inicio",link:"/"}),Ge=()=>({label:"Simpsons",link:"/simpsons"}),Oe=()=>({label:"Personajes"}),Ue=(i,t,e)=>[i,t,e],Je=()=>[],Ke=i=>["/simpsons",i],Be=(i,t)=>t.id;function Qe(i,t){i&1&&(r(0,"div",6),f(1,"span",19),s())}function We(i,t){if(i&1&&(r(0,"div",7),f(1,"app-pagination-component",20)(2,"div",21),s()),i&2){let e,n=m();a(),F("pages",((e=n.simpsonsResource())==null?null:e.pages)??0)("currentPage",n.paginationService.currentPage())}}function Xe(i,t){i&1&&(r(0,"button",23),o(1," \u2B50 En favoritos "),s())}function Ye(i,t){if(i&1){let e=M();r(0,"button",26),P("click",function(){h(e);let l=m().$implicit,p=m(2);return C(p.addToFavorites(l))}),o(1," \u2B50 Agregar "),s()}}function Ze(i,t){if(i&1&&(r(0,"tr")(1,"td"),o(2),s(),r(3,"td"),o(4),s(),r(5,"td"),o(6),s(),r(7,"td")(8,"span"),o(9),s()(),r(10,"td"),v(11,Xe,2,0,"button",23)(12,Ye,2,0,"button",24),s(),r(13,"td")(14,"a",25),o(15," Ver Detalle "),s()()()),i&2){let e=t.$implicit,n=m(2);a(2),y(e.id),a(2),y(e.name),a(2),y(e.occupation),a(2),de(ce("badge badge-",e.status==="Alive"?"success":"error")),a(),S(" ",e.status," "),a(2),_(n.isFavorite(e.name)?11:12),a(3),F("routerLink",pe(9,Ke,e.id))}}function et(i,t){if(i&1&&(r(0,"div",8)(1,"table",22)(2,"thead")(3,"tr")(4,"th"),o(5,"ID"),s(),r(6,"th"),o(7,"Nombre"),s(),r(8,"th"),o(9,"Ocupaci\xF3n"),s(),r(10,"th"),o(11,"Estado"),s(),r(12,"th"),o(13,"Favorito"),s(),f(14,"th"),s()(),r(15,"tbody"),k(16,Ze,16,11,"tr",null,Be),s()()()),i&2){let e,n=m();a(16),T(((e=n.simpsonsResource())==null?null:e.results)??V(0,Je))}}function tt(i,t){i&1&&f(0,"span",15)}function it(i,t){i&1&&o(0," \u{1F504} Actualizar ")}function nt(i,t){i&1&&(r(0,"div",16),f(1,"span",27),r(2,"p",28),o(3,"Cargando favoritos..."),s()())}function ot(i,t){i&1&&(r(0,"div",17),N(),r(1,"svg",29),f(2,"path",30),s(),D(),r(3,"span"),o(4,"A\xFAn no tienes personajes favoritos. \xA1Agrega algunos haciendo clic en el bot\xF3n \u2B50 Agregar!"),s()())}function at(i,t){i&1&&o(0," El nombre es requerido ")}function rt(i,t){i&1&&o(0," M\xEDnimo 2 caracteres ")}function st(i,t){if(i&1&&(r(0,"span",38),v(1,at,1,0)(2,rt,1,0),s()),i&2){let e,n=m(4);a(),_((e=n.editForm.get("customName"))!=null&&e.hasError("required")?1:(e=n.editForm.get("customName"))!=null&&e.hasError("minlength")?2:-1)}}function lt(i,t){if(i&1){let e=M();r(0,"form",36)(1,"input",37),P("keyup.enter",function(){h(e);let l=m(3);return C(l.saveEditedFavorite())})("keyup.escape",function(){h(e);let l=m(3);return C(l.cancelEditingFavorite())}),s(),v(2,st,3,1,"span",38),r(3,"div",39)(4,"button",40),P("click",function(){h(e);let l=m(3);return C(l.saveEditedFavorite())}),o(5," \u2713 Guardar "),s(),r(6,"button",41),P("click",function(){h(e);let l=m(3);return C(l.cancelEditingFavorite())}),o(7," \u2715 Cancelar "),s()()()}if(i&2){let e,n,l=m(3);F("formGroup",l.editForm),a(),U("input-error",((e=l.editForm.get("customName"))==null?null:e.invalid)&&((e=l.editForm.get("customName"))==null?null:e.touched)),a(),_((n=l.editForm.get("customName"))!=null&&n.invalid&&((n=l.editForm.get("customName"))!=null&&n.touched)?2:-1),a(2),F("disabled",l.editForm.invalid)}}function mt(i,t){if(i&1){let e=M();r(0,"p",42)(1,"span",43),o(2,"Apodo:"),s(),r(3,"span",44),o(4),s()(),r(5,"div",45)(6,"button",46),P("click",function(){h(e);let l=m().$implicit,p=m(2);return C(p.startEditingFavorite(l))}),o(7," \u270F\uFE0F Editar "),s(),r(8,"button",47),P("click",function(){h(e);let l=m().$implicit,p=m(2);return C(p.removeFromFavorites(l.id))}),o(9," \u{1F5D1}\uFE0F Eliminar "),s()()}if(i&2){let e=m().$implicit;a(4),y(e.customName)}}function dt(i,t){if(i&1&&(r(0,"div",31)(1,"figure",32),f(2,"img",33),s(),r(3,"div",34)(4,"h3",35),o(5),s(),v(6,lt,8,5,"form",36)(7,mt,10,1),s()()),i&2){let e=t.$implicit,n=m(2);a(2),F("src",e.image,G)("alt",e.nombre),a(2),F("title",e.nombre),a(),y(e.nombre),a(),_(n.editingFavoriteId()===e.id?6:7)}}function ct(i,t){if(i&1&&(r(0,"div",18),k(1,dt,8,5,"div",31,Be),s()),i&2){let e=m();a(),T(e.favorites())}}var je=class i{simpsonsService=u(we);paginationService=u(A);favoritesService=u(ee);authService=u(W);route=u(Q);fb=u(Pe);simpsonsResource=be(this.route.queryParamMap.pipe(z(t=>Number(t.get("page"))||1),le(t=>this.simpsonsService.getCharacters(t))),{initialValue:null});simpsonsCount=g(0);totalPages=g(0);reloadFavoritesTrigger=g(0);favoritesResource=B({params:()=>({reload:this.reloadFavoritesTrigger()}),stream:()=>this.authService.currentUser()?this.favoritesService.getFavorites():x([])});favorites=()=>this.favoritesResource.value()||[];loadingFavorites=this.favoritesResource.isLoading;addFavoriteAction=g(null);deleteFavoriteAction=g(null);updateFavoriteAction=g(null);editingFavoriteId=g(null);editForm=this.fb.group({customName:["",[oe.required,oe.minLength(2)]]});constructor(){j(()=>{let t=this.simpsonsResource();if(!t)return;this.simpsonsCount.set(t.count??0);let e=Math.ceil((t.count??0)/10);this.totalPages.set(e)}),j(()=>{this.authService.currentUser()&&this.reloadFavoritesTrigger.update(e=>e+1)}),B({params:()=>this.addFavoriteAction(),stream:({params:t})=>t?this.favoritesService.addFavorite(t.nombre,t.imagen).pipe(H(()=>{J(()=>{this.reloadFavoritesTrigger.update(e=>e+1),alert("\xA1Agregado a favoritos!")})}),$(()=>x(null))):x(null)}),B({params:()=>this.deleteFavoriteAction(),stream:({params:t})=>t?this.favoritesService.deleteFavorite(t).pipe(H(()=>{J(()=>{this.reloadFavoritesTrigger.update(e=>e+1),alert("Eliminado de favoritos")})}),$(()=>x(null))):x(null)}),B({params:()=>this.updateFavoriteAction(),stream:({params:t})=>t?this.favoritesService.updateFavorite(t.id,t.customName).pipe(H(()=>{J(()=>{this.reloadFavoritesTrigger.update(e=>e+1),this.cancelEditingFavorite(),alert("Nombre actualizado")})}),$(()=>x(null))):x(null)})}addToFavorites(t){let e=t.name||t.character,n=t.image||"";if(!e){alert("No se encontr\xF3 el nombre del personaje");return}this.addFavoriteAction.set({nombre:e,imagen:n})}removeFromFavorites(t){confirm("\xBFEliminar de favoritos?")&&this.deleteFavoriteAction.set(t)}startEditingFavorite(t){this.editingFavoriteId.set(t.id),this.editForm.patchValue({customName:t.customName})}saveEditedFavorite(){if(this.editForm.invalid){this.editForm.markAllAsTouched();return}let t=this.editingFavoriteId(),e=this.editForm.value.customName;t&&e&&this.updateFavoriteAction.set({id:t,customName:e})}cancelEditingFavorite(){this.editingFavoriteId.set(null),this.editForm.reset()}isFavorite(t){return this.favorites().some(e=>e.nombre===t)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=E({type:i,selectors:[["app-simpsons-page"]],decls:23,vars:16,consts:[[3,"items"],[1,"p-6"],[3,"simpsonsCount","totalPages"],[1,"p-8"],[1,"text-3xl","font-bold","mb-2","text-center"],[1,"text-lg","text-center","mb-6"],[1,"flex","justify-center","items-center","h-64"],[1,"flex","gap-2","items-center","h-20","mb-4"],[1,"overflow-x-auto","shadow-xl","rounded-lg","bg-base-100"],[1,"mt-12","p-6","bg-base-200","rounded-xl","shadow-2xl"],[1,"flex","items-center","justify-between","mb-6","border-b","pb-3","border-yellow-300"],[1,"text-2xl","font-bold","flex","items-center","gap-2","text-yellow-800"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24",1,"h-6","w-6","fill-current","text-yellow-500"],["d","M12 17.27l6.18 3.73-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73-1.64 7.03z"],[1,"btn","btn-sm","btn-ghost","text-yellow-700","hover:bg-yellow-100",3,"click","disabled"],[1,"loading","loading-spinner","loading-sm","text-yellow-500"],[1,"flex","justify-center","items-center","py-12"],[1,"alert","alert-warning","shadow-lg","bg-white","border-l-4","border-yellow-500"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-6"],[1,"loading","loading-spinner","loading-lg"],[3,"pages","currentPage"],[1,"flex","flex-1"],[1,"table"],["disabled","",1,"btn","btn-sm","btn-ghost","bg-yellow-200","text-yellow-900","hover:bg-yellow-300"],[1,"btn","btn-sm","btn-primary","bg-yellow-500","hover:bg-yellow-600","border-none","text-white"],[1,"btn","btn-sm","btn-info",3,"routerLink"],[1,"btn","btn-sm","btn-primary","bg-yellow-500","hover:bg-yellow-600","border-none","text-white",3,"click"],[1,"loading","loading-spinner","loading-lg","text-yellow-500"],[1,"ml-3","text-lg","text-gray-600"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"stroke-current","shrink-0","w-6","h-6","text-yellow-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"card","bg-white","shadow-xl","hover:shadow-2xl","transition","duration-300"],[1,"px-4","pt-4"],["onerror","this.onerror=null; this.src='https://placehold.co/192x192/fde047/333?text=N/A'",1,"rounded-xl","h-48","w-full","object-cover","border-2","border-yellow-300",3,"src","alt"],[1,"card-body","p-4"],[1,"card-title","text-base","text-yellow-900","truncate",3,"title"],[1,"form-control","mt-2",3,"formGroup"],["type","text","formControlName","customName","placeholder","Nombre personalizado",1,"input","input-bordered","input-sm","bg-yellow-50","border-yellow-300",3,"keyup.enter","keyup.escape"],[1,"text-error","text-xs","mt-1"],[1,"flex","gap-2","mt-3"],["type","button",1,"btn","btn-xs","btn-success","flex-1",3,"click","disabled"],["type","button",1,"btn","btn-xs","btn-ghost","flex-1",3,"click"],[1,"text-xs","opacity-80","mt-1"],[1,"font-bold","text-yellow-700"],[1,"block","mt-0.5","text-gray-700"],[1,"card-actions","justify-end","mt-4"],[1,"btn","btn-xs","btn-ghost","text-yellow-600","hover:text-yellow-800",3,"click"],[1,"btn","btn-xs","btn-error","bg-red-500","hover:bg-red-600","text-white","border-none",3,"click"]],template:function(e,n){if(e&1&&(f(0,"app-breadcrumbs",0),r(1,"section",1),f(2,"app-hero-simpsons",2),r(3,"section",3)(4,"h1",4),o(5,"The Simpsons API"),s(),r(6,"h2",5),o(7,"Listado de personajes"),s(),v(8,Qe,2,0,"div",6),v(9,We,3,2,"div",7),v(10,et,18,1,"div",8),r(11,"div",9)(12,"div",10)(13,"h2",11),N(),r(14,"svg",12),f(15,"path",13),s(),o(16," Mis Favoritos "),s(),D(),r(17,"button",14),P("click",function(){return n.loadingFavorites()}),v(18,tt,1,0,"span",15)(19,it,1,0),s()(),v(20,nt,4,0,"div",16)(21,ot,5,0,"div",17)(22,ct,3,0,"div",18),s()()()),e&2){let l;F("items",ue(12,Ue,V(9,qe),V(10,Ge),V(11,Oe))),a(2),F("simpsonsCount",((l=n.simpsonsResource())==null?null:l.count)??0)("totalPages",n.totalPages()),a(6),_(n.simpsonsResource()?-1:8),a(),_(n.simpsonsResource()!==null?9:-1),a(),_(n.simpsonsResource()?10:-1),a(7),F("disabled",n.loadingFavorites()),a(),_(n.loadingFavorites()?18:19),a(2),_(n.loadingFavorites()?20:n.favorites().length===0?21:22)}},dependencies:[K,fe,_e,X,Y,Z,ye,Fe,xe,he,Ce,Se,Ee],encapsulation:2})};export{je as a};
